<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Beranda - Inazuma Market</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet" />
    
    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-content">
            <a href="/" class="brand">
                <span class="material-symbols-outlined">bolt</span>
                INAZUMA MARKET
            </a>

            <div class="nav-links">
                <!-- Cart Button -->
                <a th:href="${user != null ? '/keranjang' : '/login'}" 
                   class="cart-button" 
                   style="position: relative; display: flex; align-items: center;">
                    <span class="material-symbols-outlined" style="font-size: 1.8rem;">shopping_cart</span>
                    <span th:if="${cartCount != null and cartCount > 0}" 
                          th:text="${cartCount}" 
                          class="badge">
                    </span>
                </a>

                <!-- User Dropdown (Logged In) -->
                <div th:if="${user != null}" class="dropdown" id="userDropdown">
                    <div class="flex items-center gap-1" onclick="toggleDropdown()">
                        <div style="width: 35px; height: 35px; background: linear-gradient(45deg, #6c5ce7, #a29bfe); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span class="material-symbols-outlined" style="color: #fff;">person</span>
                        </div>
                        <div class="flex flex-col" style="line-height: 1.2; text-align: left;">
                            <span th:text="${user.namaLengkap}" style="font-weight: bold; font-size: 0.9rem;">Traveler</span>
                            <small style="color: #a29bfe; font-size: 0.7rem;">Vision Holder</small>
                        </div>
                        <span class="material-symbols-outlined" style="font-size: 1.2rem;">expand_more</span>
                    </div>

                    <div class="dropdown-menu">
                        <a href="/profil" class="dropdown-item">
                            <span class="material-symbols-outlined icon">manage_accounts</span> Profil
                        </a>
                        <a href="/riwayat" class="dropdown-item">
                            <span class="material-symbols-outlined icon">history</span> Riwayat
                        </a>
                        <a href="/keranjang" class="dropdown-item">
                            <span class="material-symbols-outlined icon">shopping_bag</span> Tas
                        </a>

                        <div th:if="${user.role.name() == 'ADMIN'}"
                            style="border-top: 1px solid rgba(255,255,255,0.1); margin: 5px 0;"></div>
                        <a th:if="${user.role.name() == 'ADMIN'}" 
                           href="/admin/produk" 
                           class="dropdown-item"
                           style="color: var(--gold);">
                            <span class="material-symbols-outlined icon">admin_panel_settings</span> Admin Panel
                        </a>

                        <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 5px 0;"></div>
                        <a href="/logout" class="dropdown-item" style="color: #ff6b6b;">
                            <span class="material-symbols-outlined icon">logout</span> Logout
                        </a>
                    </div>
                </div>

                <!-- Login/Register Buttons (Not Logged In) -->
                <div th:unless="${user != null}" class="flex gap-1">
                    <a href="/login" class="btn btn-outline">Masuk</a>
                    <a href="/daftar" class="btn btn-gold">Daftar</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-top: 40px; padding-bottom: 60px;">

        <!-- Search Section -->
        <section class="search-section">
            <form action="/" method="get" id="searchForm" class="search-grid">
                <!-- Search Input -->
                <div class="input-wrapper">
                    <span class="material-symbols-outlined search-icon">search</span>
                    <input type="text" 
                           name="keyword" 
                           class="form-control" 
                           placeholder="Cari artefak, senjata, atau barang langka..."
                           th:value="${keyword != null ? keyword : ''}"
                           autocomplete="off">
                </div>

                <!-- Category Filter -->
                <select name="kategori" 
                        class="form-select" 
                        onchange="this.form.submit()">
                    <option value="">Semua Kategori</option>
                    <option value="Senjata" th:selected="${kategori != null and kategori == 'Senjata'}">âš”ï¸ Senjata</option>
                    <option value="Makanan" th:selected="${kategori != null and kategori == 'Makanan'}">ğŸœ Makanan</option>
                    <option value="Material" th:selected="${kategori != null and kategori == 'Material'}">ğŸª¨ Material</option>
                    <option value="Aksesoris" th:selected="${kategori != null and kategori == 'Aksesoris'}">ğŸ’ Aksesoris</option>
                    <option value="Merchandise" th:selected="${kategori != null and kategori == 'Merchandise'}">ğŸ Merchandise</option>
                    <option value="Buku" th:selected="${kategori != null and kategori == 'Buku'}">ğŸ“š Buku</option>
                    <option value="Gadget" th:selected="${kategori != null and kategori == 'Gadget'}">ğŸ“± Gadget</option>
                    <option value="Cosplay" th:selected="${kategori != null and kategori == 'Cosplay'}">ğŸ‘˜ Cosplay</option>
                    <option value="Apparel" th:selected="${kategori != null and kategori == 'Apparel'}">ğŸ‘• Apparel</option>
                    <option value="Figure" th:selected="${kategori != null and kategori == 'Figure'}">ğŸ—¿ Figure</option>
                    <option value="Boneka" th:selected="${kategori != null and kategori == 'Boneka'}">ğŸ§¸ Boneka</option>
                    <option value="Lainnya" th:selected="${kategori != null and kategori == 'Lainnya'}">ğŸ² Lainnya</option>
                </select>

                <!-- Sort Filter -->
                <select name="sortBy" 
                        class="form-select" 
                        onchange="this.form.submit()">
                    <option value="" th:selected="${sortBy == null}">ğŸ“… Terbaru</option>
                    <option value="termurah" th:selected="${sortBy != null and sortBy == 'termurah'}">ğŸ’° Harga Terendah</option>
                    <option value="termahal" th:selected="${sortBy != null and sortBy == 'termahal'}">ğŸ’ Harga Tertinggi</option>
                    <option value="nama" th:selected="${sortBy != null and sortBy == 'nama'}">ğŸ”¤ Nama (A-Z)</option>
                </select>

                <!-- Search Button -->
                <button type="submit" class="btn btn-gold">
                    <span class="material-symbols-outlined">filter_list</span> Cari
                </button>
            </form>
        </section>

        <!-- Current Filters -->
        <div th:if="${keyword != null or kategori != null}" class="current-filters">
            <div th:if="${keyword != null and keyword != ''}" class="filter-tag">
                <span class="material-symbols-outlined" style="font-size: 1rem;">search</span>
                <span th:text="'Pencarian: ' + ${keyword}"></span>
                <a th:href="@{/(kategori=${kategori != null ? kategori : ''}, sortBy=${sortBy != null ? sortBy : ''})}" 
                   class="remove-btn">
                    <span class="material-symbols-outlined">close</span>
                </a>
            </div>
            <div th:if="${kategori != null and kategori != ''}" class="filter-tag">
                <span class="material-symbols-outlined" style="font-size: 1rem;">category</span>
                <span th:text="'Kategori: ' + ${kategori}"></span>
                <a th:href="@{/(keyword=${keyword != null ? keyword : ''}, sortBy=${sortBy != null ? sortBy : ''})}" 
                   class="remove-btn">
                    <span class="material-symbols-outlined">close</span>
                </a>
            </div>
        </div>

        <!-- Catalog Header -->
        <div class="catalog-header">
            <div>
                <h2 class="gradient-text text-glow">KATALOG BARANG</h2>
                <p>
                    <span th:text="${listProduk != null ? listProduk.size() : 0} + ' produk ditemukan'" class="product-count"></span>
                    <span th:if="${keyword != null and keyword != ''}" style="margin-left: 15px; color: var(--secondary);">
                        untuk "<span th:text="${keyword}" style="font-style: italic;"></span>"
                    </span>
                </p>
            </div>
        </div>

        <!-- Product Grid -->
        <div id="product-container" class="product-grid">
            <!-- Product Cards -->
            <div th:each="p : ${listProduk}" 
                 class="product-card"
                 th:attr="data-rarity=${p.harga > 1000000 ? 'legendary' : (p.harga > 500000 ? 'epic' : (p.harga > 100000 ? 'rare' : 'common'))}">
                <a th:href="@{/produk/{id}(id=${p.idProduct})}">
                    <!-- Product Image -->
                    <div class="card-img-wrapper">
                        <img th:if="${p.gambarProduct != null}" 
                             th:src="'data:image/jpeg;base64,' + ${p.gambarProduct}"
                             class="card-img-top"
                             th:alt="${p.namaProduct}"
                             loading="lazy">
                        <div th:unless="${p.gambarProduct != null}" 
                             class="card-img-top flex justify-center items-center"
                             style="background: linear-gradient(45deg, #2d3436, #636e72); color: #b2bec3;">
                            <span class="material-symbols-outlined" style="font-size: 3rem;">image_not_supported</span>
                        </div>
                        <span class="card-badge" th:text="${p.kategoriProduct}">Kat</span>
                    </div>

                    <!-- Product Info -->
                    <div class="card-body">
                        <!-- Rarity Stars -->
                        <div class="product-rarity">
                            <span class="material-symbols-outlined">star</span>
                            <span class="material-symbols-outlined">star</span>
                            <span class="material-symbols-outlined">star</span>
                            <span class="material-symbols-outlined">star</span>
                            <span th:text="${p.harga > 1000000 ? 'Legendary' : (p.harga > 500000 ? 'Epic' : (p.harga > 100000 ? 'Rare' : 'Common'))}">
                                Rarity
                            </span>
                        </div>

                        <!-- Product Title -->
                        <h3 class="product-title" th:text="${p.namaProduct}">Nama Produk</h3>

                        <!-- Price and Action -->
                        <div class="card-footer">
                            <span class="price" th:text="'Rp ' + ${#numbers.formatInteger(p.harga, 0, 'POINT')}">Rp 0</span>
                            <span class="material-symbols-outlined">arrow_circle_right</span>
                        </div>
                    </div>
                </a>
            </div>

            <!-- Empty State -->
            <div th:if="${listProduk != null and listProduk.empty}" class="empty-state">
                <span class="material-symbols-outlined">inventory_2</span>
                <h3>Tidak ada barang ditemukan</h3>
                <p th:if="${keyword != null and keyword != ''}">
                    Tidak ada hasil untuk pencarian "<span th:text="${keyword}" style="color: var(--secondary);"></span>"
                </p>
                <p th:unless="${keyword != null and keyword != ''}">
                    Coba gunakan filter yang berbeda atau lihat kategori lainnya
                </p>
                <a href="/" class="btn btn-outline">
                    <span class="material-symbols-outlined">refresh</span> Reset Filter
                </a>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="loading-indicator" style="display: none;">
            <div class="spinner-large"></div>
            <p>Mencari di arsip Inazuma...</p>
        </div>

        <!-- End of List Marker -->
        <div id="end-of-list"></div>

    </main>

    <!-- JavaScript Configuration -->
    <script th:inline="javascript">
        window.appConfig = {
            totalPages: /*[[${totalPages != null ? totalPages : 1}]]*/ 1,
            currentPage: /*[[${page != null ? page : 1}]]*/ 1,
            keyword: /*[[${keyword != null ? keyword : ''}]]*/ '',
            kategori: /*[[${kategori != null ? kategori : ''}]]*/ '',
            sortBy: /*[[${sortBy != null ? sortBy : ''}]]*/ '',
            totalProducts: /*[[${listProduk != null ? listProduk.size() : 0}]]*/ 0
        };
    </script>

    <script th:src="@{/js/home-script.js}"></script>
</body>
</html>