<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Checkout - Inazuma Market</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap-icons.css}">
    
    <style>
        /* === ATMOSPHERE === */
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #1e1535;
            background-image: url('https://raw.githubusercontent.com/Yuuashura/assets/refs/heads/main/1362745.png');
            background-attachment: fixed; background-size: cover; background-position: center;
            color: #fff; min-height: 100vh;
        }
        body::after {
            content: ''; position: fixed; inset: 0; background: rgba(10, 5, 20, 0.85); z-index: -1;
        }

        /* === NAVBAR === */
        .navbar-glass {
            background: rgba(30, 20, 60, 0.85); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(162, 155, 254, 0.2);
        }
        .brand-title { font-family: 'Cinzel', serif; font-weight: 700; letter-spacing: 2px; color: #a29bfe; }

        /* === GLASS CARD === */
        .glass-panel {
            background: rgba(40, 30, 70, 0.6);
            border: 1px solid rgba(162, 155, 254, 0.2);
            border-radius: 15px; padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            height: 100%;
        }

        /* FORM ELEMENTS */
        .form-label { color: #a29bfe; font-weight: bold; font-size: 0.9rem; margin-bottom: 8px; }
        
        .form-control, .form-select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(162, 155, 254, 0.3);
            color: #fff; border-radius: 10px; padding: 12px;
        }
        .form-control:focus, .form-select:focus {
            background: rgba(0, 0, 0, 0.5);
            border-color: #a29bfe; color: #fff; box-shadow: 0 0 15px rgba(162, 155, 254, 0.3);
        }
        /* Placeholder styling */
        ::placeholder { color: rgba(255, 255, 255, 0.3) !important; }

        /* LIST GROUP */
        .list-group-item {
            background: transparent; color: #fff;
            border-color: rgba(255, 255, 255, 0.1);
            padding: 15px 0;
        }
        
        /* SUMMARY SECTION */
        .summary-title { font-family: 'Cinzel', serif; color: #fdcb6e; margin-bottom: 20px; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; color: #ccc; }
        .total-row {
            display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 1.2rem; font-weight: bold; color: #fff;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border: none; color: #2d3436; font-weight: bold; font-family: 'Cinzel', serif;
            border-radius: 50px; width: 100%; padding: 15px; margin-top: 25px;
            transition: 0.3s; letter-spacing: 1px;
        }
        .btn-gold:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(253, 203, 110, 0.5);
            color: #000;
        }
        
        .section-title { font-family: 'Cinzel', serif; color: #fff; border-bottom: 2px solid #a29bfe; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-glass p-3 sticky-top">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <i class="bi bi-lightning-charge-fill me-2" style="color: #a29bfe;"></i>
            <span class="brand-title">INAZUMA MARKET</span>
        </a>
        <a href="/keranjang" class="btn btn-sm btn-outline-light rounded-pill px-3">
            <i class="bi bi-arrow-left me-2"></i> Kembali
        </a>
    </div>
</nav>

<div class="container py-5">
    <h2 class="mb-5 text-center" style="font-family: 'Cinzel'; color: #fdcb6e;">Konfirmasi Pengiriman</h2>

    <form action="/transaksi/proses" method="post">
        <div class="row g-4">
            
            <div class="col-lg-7">
                
                <div class="glass-panel mb-4">
                    <h5 class="section-title"><i class="bi bi-geo-alt-fill me-2"></i>Alamat Tujuan</h5>
                    
                    <div class="mb-3">
                        <label class="form-label">Alamat Lengkap</label>
                        <textarea name="alamatLengkap" class="form-control" rows="3" placeholder="Nama Jalan, RT/RW, Nomor Rumah, Kelurahan..." required></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pilih Wilayah (Ongkir)</label>
                        <select name="idProvinsi" class="form-select" id="selectProvinsi" onchange="hitungGrandTotal()" required>
                            <option value="" data-ongkir="0" class="text-dark">-- Pilih Wilayah --</option>
                            <option th:each="p : ${listProvinsi}" 
                                    th:value="${p.idProvinsi}" 
                                    th:text="${p.namaProvinsi} + ' (Ongkir: ' + ${p.hargaOngkir} + ')'"
                                    th:data-ongkir="${p.hargaOngkir}"
                                    class="text-dark">
                            </option>
                        </select>
                    </div>
                </div>

                <div class="glass-panel">
                    <h5 class="section-title"><i class="bi bi-box-seam me-2"></i>Barang yang Dibeli</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="item : ${listBarang}">
                            <div>
                                <span class="fw-bold d-block" th:text="${item.produk.namaProduct}">Produk</span>
                                <small class="text-white-50" th:text="${item.jumlah} + ' x Rp ' + ${item.harga}">1 x 10000</small>
                                <input type="hidden" name="idKeranjang" th:value="${item.idKeranjang}">
                            </div>
                            <span class="fw-bold text-warning" th:text="'Rp ' + ${item.harga * item.jumlah}">Rp 0</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-5">
                <div class="glass-panel sticky-top" style="top: 100px; border: 1px solid rgba(253, 203, 110, 0.3);">
                    <h5 class="summary-title text-center"><i class="bi bi-receipt me-2"></i>Rincian Biaya</h5>
                    
                    <div class="mt-4">
                        <div class="summary-row">
                            <span>Subtotal Barang</span>
                            <span class="fw-bold" th:text="'Rp ' + ${subtotal}">Rp 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Biaya Pengiriman</span>
                            <span class="fw-bold text-info" id="displayOngkir">Rp 0</span>
                        </div>
                        
                        <div class="total-row">
                            <span>Total Pembayaran</span>
                            <span class="text-warning" id="displayGrandTotal">Rp 0</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-gold shadow">
                        <i class="bi bi-shield-lock-fill me-2"></i> BAYAR SEKARANG
                    </button>
                    
                    <div class="text-center mt-3 small text-white-50">
                        <i class="bi bi-info-circle me-1"></i> Pastikan alamat sudah benar.
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<input type="hidden" id="serverSubtotal" th:value="${subtotal}">

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/checkout.js}"></script>

</body>
</html>