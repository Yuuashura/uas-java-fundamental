<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Form Artefak - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Quicksand:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    
    <link rel="stylesheet" th:href="@{/css/global.css}">
    
    <style>
        body { 
            display: flex; align-items: center; justify-content: center; 
            min-height: 100vh; padding: 20px;
        }

        .form-card {
            background: rgba(40, 30, 70, 0.85);
            border: 1px solid rgba(162, 155, 254, 0.3);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 750px;
            backdrop-filter: blur(10px);
        }
        
        .title { 
            font-family: 'Cinzel', serif; color: var(--gold); 
            text-align: center; margin-bottom: 30px; letter-spacing: 2px;
        }

        /* Form Grid System Manual (Pengganti Bootstrap Row/Col) */
        .grid-2 {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;
        }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #a29bfe; font-size: 0.9rem; }
        
        .img-preview-box {
            width: 100px; height: 100px;
            border: 2px dashed rgba(162, 155, 254, 0.5);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; margin-bottom: 10px;
            background: rgba(0,0,0,0.2);
        }
        .img-preview-box img { width: 100%; height: 100%; object-fit: cover; }
        .img-placeholder { font-size: 2rem; color: rgba(255,255,255,0.2); }

        .btn-group { display: flex; gap: 15px; margin-top: 30px; }
        .w-50 { width: 50%; }

        @media (max-width: 600px) {
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="form-card">
    <h3 class="title" th:text="${produk.idProduct == null ? 'TEMPA ITEM BARU' : 'MODIFIKASI ITEM'}">Form</h3>
    
    <form th:action="@{${produk.idProduct == null} ? '/admin/produk/simpan' : '/admin/produk/update'}" 
          th:object="${produk}" method="post" enctype="multipart/form-data">
        
        <input type="hidden" th:field="*{idProduct}">

        <div class="grid-2">
            <div>
                <label class="form-label">Nama Barang</label>
                <input type="text" th:field="*{namaProduct}" class="form-control" placeholder="Ex: Mistsplitter" required>
            </div>
            <div>
                <label class="form-label">Kategori</label>
                <select th:field="*{kategoriProduct}" class="form-select">
                    <option value="" disabled selected>-- Pilih Jenis --</option>
                    <option value="Senjata">Senjata (Weapons)</option>
                    <option value="Makanan">Makanan (Food)</option>
                    <option value="Material">Material & Flora</option>
                    <option value="Aksesoris">Aksesoris & Artefak</option>
                    <option value="Merchandise">Merchandise & Pajangan</option>
                    <option value="Buku">Buku & Novel</option>
                    <option value="Gadget">Gadget & Alat</option>
                    <option value="Lainnya">Lainnya</option>
                    <option value="Cosplay">Cosplay & Wig</option>
                    <option value="Apparel">Apparel (Baju)</option>
                    <option value="Figure">Figure & Pajangan</option>
                    <option value="Boneka">Boneka & Plushie</option>
                </select>
            </div>
        </div>

        <div class="grid-2">
            <div>
                <label class="form-label">Harga (Mora)</label>
                <input type="number" th:field="*{harga}" class="form-control" min="1" placeholder="0" required>
            </div>
            <div>
                <label class="form-label">Stok Gudang</label>
                <input type="number" th:field="*{stock}" class="form-control" min="0" placeholder="0" required>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Deskripsi Lengkap</label>
            <textarea th:field="*{deskripsiProduct}" class="form-control" rows="3" placeholder="Jelaskan detail barang..."></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">Visual (Gambar)</label>
            
            <div class="img-preview-box">
                <img id="preview" th:if="${produk.gambarProduct != null}" th:src="'data:image/jpeg;base64,' + ${produk.gambarProduct}">
                <span id="placeholder" th:if="${produk.gambarProduct == null}" class="material-symbols-outlined img-placeholder">image</span>
                <img id="preview-new" style="display: none;">
            </div>

            <input type="file" name="fileGambar" id="fileInput" class="form-control" accept="image/*" th:required="${produk.idProduct == null}">
        </div>

        <div class="btn-group">
            <a href="/admin/produk" class="btn btn-outline w-50">Batal</a>
            <button type="submit" class="btn btn-gold w-50">SIMPAN</button>
        </div>
    </form>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const previewNew = document.getElementById('preview-new');
    const previewOld = document.getElementById('preview');
    const placeholder = document.getElementById('placeholder');
    const previewBox = document.querySelector('.img-preview-box');

    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                // Sembunyikan elemen lama/placeholder
                if(previewOld) previewOld.style.display = 'none';
                if(placeholder) placeholder.style.display = 'none';
                
                // Tampilkan gambar baru
                previewNew.src = e.target.result;
                previewNew.style.display = 'block';
                if(!previewBox.contains(previewNew)) {
                    previewBox.appendChild(previewNew);
                }
            }
            reader.readAsDataURL(file);
        }
    });
</script>

</body>
</html>