<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${produk.namaProduct} + ' - Toko Yudis'">Detail Produk</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .product-image-container {
            background: white; border-radius: 20px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center;
        }
        .main-img { max-width: 100%; max-height: 400px; object-fit: contain; border-radius: 10px; }
        
        .product-title { font-weight: 700; color: #2d3436; font-size: 1.8rem; }
        .product-price { color: #764ba2; font-weight: 700; font-size: 1.6rem; letter-spacing: -0.5px; }
        .category-badge { background-color: #e9ecef; color: #6c757d; font-size: 0.8rem; padding: 5px 12px; border-radius: 50px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        
        .btn-add-cart {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            border: none; color: white; padding: 12px; border-radius: 50px; 
            font-weight: 600; width: 100%; transition: 0.3s;
        }
        .btn-add-cart:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(118, 75, 162, 0.3); color: white; }
        
        /* Quantity Spinner */
        .qty-container { display: flex; align-items: center; border: 2px solid #eee; border-radius: 50px; width: fit-content; padding: 5px; }
        .btn-qty { width: 35px; height: 35px; border-radius: 50%; border: none; background: #f1f3f5; color: #333; font-weight: bold; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-qty:hover { background: #dee2e6; }
        
        .input-qty { border: none; text-align: center; width: 60px; font-weight: bold; font-size: 1.1rem; background: transparent; }
        .input-qty:focus { outline: none; background-color: #f8f9fa; border-radius: 5px; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .breadcrumb-item a { text-decoration: none; color: #764ba2; }
        .breadcrumb-item.active { color: #adb5bd; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark p-3 shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/"><i class="bi bi-shop me-2"></i>TOKO YUDIS</a>
        <div class="d-flex align-items-center">
            <a href="/keranjang" class="text-white position-relative me-3 fs-5"><i class="bi bi-cart3"></i></a>
            <div th:if="${user != null}" class="text-white fw-bold ps-3 border-start border-white border-opacity-25">
                <span th:text="${user.namaLengkap}">User</span>
            </div>
            <div th:unless="${user != null}">
                <a href="/login" class="btn btn-sm btn-light rounded-pill fw-bold text-primary px-3">Login</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4 mb-5">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/"><i class="bi bi-house-door-fill"></i> Home</a></li>
            <li class="breadcrumb-item"><a href="#">Produk</a></li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${produk.namaProduct}">Nama</li>
        </ol>
    </nav>

    <div class="row gx-5">
        <div class="col-md-5 mb-4">
            <div class="product-image-container">
                <img th:if="${produk.gambarProduct != null}" 
                     th:src="'data:image/jpeg;base64,' + ${produk.gambarProduct}" 
                     class="main-img" alt="Produk">
                <div th:unless="${produk.gambarProduct != null}" class="py-5 text-muted">
                    <i class="bi bi-image display-1 opacity-25"></i> <p>Gambar tidak tersedia</p>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="ps-md-3">
                <span class="category-badge mb-2 d-inline-block" th:text="${produk.kategoriProduct}">Kategori</span>
                <h1 class="product-title mb-2" th:text="${produk.namaProduct}">Laptop Gaming ROG</h1>
                
                <div class="d-flex align-items-center mb-4">
                    <h2 class="product-price m-0 me-3" th:text="'Rp ' + ${produk.harga}">Rp 25.000.000</h2>
                    <span th:if="${produk.stock > 5}" class="badge bg-success bg-opacity-10 text-success border border-success rounded-pill px-3">
                        <i class="bi bi-check-circle-fill me-1"></i> Stok Tersedia (<span th:text="${produk.stock}">10</span>)
                    </span>
                    <span th:if="${produk.stock > 0 and produk.stock <= 5}" class="badge bg-warning bg-opacity-10 text-warning border border-warning rounded-pill px-3">
                        <i class="bi bi-exclamation-circle-fill me-1"></i> Stok Menipis (<span th:text="${produk.stock}">3</span>)
                    </span>
                    <span th:if="${produk.stock == 0}" class="badge bg-danger bg-opacity-10 text-danger border border-danger rounded-pill px-3">
                        <i class="bi bi-x-circle-fill me-1"></i> Stok Habis
                    </span>
                </div>

                <div class="mb-4">
                    <h6 class="fw-bold text-dark">Deskripsi Produk</h6>
                    <p class="text-muted" style="line-height: 1.8;" th:text="${produk.deskripsiProduct}">Desc...</p>
                </div>

                <hr class="my-4 border-secondary border-opacity-10">

                <form action="/keranjang/tambah" method="post" th:if="${produk.stock > 0}">
                    <input type="hidden" name="idProduct" th:value="${produk.idProduct}">
                    
                    <div class="row align-items-end">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <label class="form-label fw-bold small text-muted">Jumlah Pembelian</label>
                            <div class="qty-container">
                                <button type="button" class="btn-qty" onclick="ubahQty(-1)">-</button>
                                
                                <input type="number" name="jumlah" id="inputJumlah" 
                                       value="1" min="1" th:max="${produk.stock}" 
                                       class="input-qty" onchange="validasiManual()">
                                
                                <button type="button" class="btn-qty" onclick="ubahQty(1)">+</button>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <button type="submit" class="btn btn-add-cart py-3 shadow">
                                <i class="bi bi-bag-plus-fill me-2"></i> Masukkan Keranjang
                            </button>
                        </div>
                    </div>
                </form>

                <div th:if="${produk.stock == 0}">
                    <button class="btn btn-secondary w-100 py-3 disabled" disabled>Stok Habis - Tidak Bisa Dipesan</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const maxStock = [[${produk.stock}]];
    const input = document.getElementById('inputJumlah');

    // 1. Fungsi Tombol +/-
    function ubahQty(change) {
        let val = parseInt(input.value) || 1; 
        val += change;
        checkBounds(val);
    }

    // 2. Fungsi Input Manual (Diketik)
    function validasiManual() {
        let val = parseInt(input.value);
        if (isNaN(val)) val = 1;
        checkBounds(val);
    }

    // 3. Cek Batas Atas & Bawah dengan CONFIRM
    function checkBounds(val) {
        if (val < 1) {
            val = 1;
        } 
        if (val > maxStock) {
            // MUNCULKAN POPUP CONFIRM
            let setMax = confirm("Jumlah melebihi stok yang tersedia (" + maxStock + ").\nApakah ingin mengubah jumlah ke maksimal stok?");
            
            if (setMax) {
                val = maxStock; // User pilih OK
            } else {
                val = 1; // User pilih Cancel (kembali ke 1)
            }
        }
        input.value = val;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>